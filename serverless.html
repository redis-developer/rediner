<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Serverless Deployment</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="site.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script type="text/javascript" src="site.js"></script>
</head>
<body>
<nav id="branding">

   <span class="item">
   <a href="https://redislabs.com/">
   <img class="logo" src="https://docs.redislabs.com/latest/images/icon_logo/logo-redis-2.svg">
   </a>
   </span>

   <span class="item">
      <a href="./">Project: Rediner</a>
   </span>

   <span class="item">
      <a href="https://github.com/redis-developer/rediner">(source)</a>
   </span>

   <span class="item">
      <a href="https://rediner.milowski.io">(demo)</a>
   </span>

</nav>

<nav id="secondary">
<span class="item"><a href="collect.html">Collecting Data</a></span>
<span class="item"><a href="data.html">Data Architecture</a></span>
<span class="item"><a href="ingest.html">Ingesting Data</a></span>
<span class="item"><a href="query.html">Querying Data</a></span>
<span class="item"><a href="application.html">Demo Application</a></span>
<span class="item"><a href="serverless.html">Serverless</a></span>
</nav>
<header id="title-block-header">
<h1 class="title">Serverless Deployment</h1>
</header>
<p>The demo application can be deployed via AWS Lambda as a serverless web application. The Redis database needs to be accessible from the VPC in which the AWS Lambda function runs. Otherwise, the application remains unchanged.</p>
<p>The Flask application is invoked via AWS Lambda using the <a href="https://github.com/alexmilowski/flask-serverless">flask-serverless</a> library. The application must be packaged into a zip file containing all the dependancies and the invocation function.</p>
<p>You can package the application by:</p>
<ol type="1">
<li><p>Configure your environment:</p>
<pre><code>export DOCKERID=yourdockerid
export BASE=$HOME/workspace/github
mkdir -p $BASE
cd $BASE</code></pre>
<p>where the <code>yourdockerid</code> is your dockerhub identifier and <code>BASE</code> points to the directory where you want your code locally for the build.</p></li>
<li><p>If you haven’t already done so, checkout the rediner project:</p>
<pre><code>git clone https://github.com/redis-developer/rediner.git</code></pre></li>
<li><p>Checkout the flask-serverless project as a sibling directory:</p>
<pre><code>git clone https://github.com/alexmilowski/flask-serverless.git</code></pre>
<p>You should now have the <code>rediner</code> and <code>flask-serverless</code> as sibling directories.</p></li>
<li><p>Building the build script as a docker container:</p>
<pre><code>cd rediner/serverless
docker build . -t $DOCKERID/rediner-demo-lambda-build</code></pre></li>
<li><p>Build the packaging via the docker image:</p>
<pre><code>docker run --rm -v `pwd`:/build -v $BASE/rediner/:/rediner -v $BASE/flask-serverless/:/flask-serverless  $DOCKERID/rediner-demo-lambda-build:latest</code></pre></li>
</ol>
<p>After the container exits, you should have a <code>lambda.zip</code> to upload for the AWS Lambda function.</p>
<p>To create the AWS Lambda function:</p>
<ul>
<li>Choose an Python 3.8 environment</li>
<li>Select the appropriate VPC to enable access to your database</li>
<li>Upload the <code>lambda.zip</code> as the implementation</li>
<li>In “Basic Settings”, change the handler to “production.lambda_handler” and adjust the timeout and memory (e.g., 2 minutes and 256MB)</li>
<li>Set the GRAPH, REDIS_HOST, REDIS_PORT, and REDIS_PASSWORD environment variables to the appropriate values.</li>
</ul>
<p>To expose the AWS Lambda function as a web application, you will will have to configure an API Gateway and with a Lambda Proxy for the root resource “/” and “/{proxy+}”.</p>
</body>
</html>
